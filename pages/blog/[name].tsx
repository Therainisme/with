import type { NextPage } from 'next';
import { useRouter } from 'next/router';
import Head from 'next/head';
import { AsyncFuncReturnType, getBlogContent, getBlogs } from '../../util';
import { compileMarkdown } from '../../util/md';
import style from "../../styles/blog/index.module.css";


type Props = AsyncFuncReturnType<typeof getStaticProps>['props'];
type Params = AsyncFuncReturnType<typeof getStaticPaths>['paths'][0];

export async function getStaticPaths() {
  const blogs = await getBlogs();

  return {
    paths: [
      ...blogs.map((name) => {
        return { params: { name } };
      }),
    ],
    fallback: false, // 没有匹配的 path，返回 404
  };
}

export async function getStaticProps({ params }: Params) {
  const [content] = await getBlogContent(params.name);

  const html = compileMarkdown(content);

  return {
    props: {
      name: params.name,
      content,
      html,
    }
  };
}

export default function Blog(props: Props) {

  return (
    <div>
      <Head>
        <title>{props.name} - blog</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <div className={style.container}>
        <div className={style.markdown}>
          <div className="markdown-body" dangerouslySetInnerHTML={{ __html: props.html }}></div>
        </div>
      </div>
    </div>
  );
}